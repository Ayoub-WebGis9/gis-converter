<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Coordinate Converter - CartoMaroc</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Zain&display=swap" rel="stylesheet">

<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: 'Zain', sans-serif;
}
#map {
  width: 100%;
  height: 100%;
  font-size: 11px !important;
}

/* أداة التحويل */
.converter {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255,255,255,0.9);
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-size: 12px;
  z-index: 1000;
}

.converter select, .converter input, .converter button {
  font-family: 'Zain', sans-serif;
  font-size: 12px;
  margin-top: 4px;
  width: 100%;
}

.copy-btn {
  background: black;
  color: white;
  padding: 5px 10px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 6px;
  display: inline-block;
  font-size: 11px;
}

/* التوقيع */
#footer {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,255,255,0.8);
  padding: 3px 10px;
  border-radius: 8px;
  font-weight: bold;
  font-size: 12px;
  z-index: 1000;
  font-family: 'Zain', sans-serif;
}
</style>
</head>
<body>

<div id="map"></div>

<div class="converter">
  <label>نظام التحويل:</label>
  <select id="zone">
    <option value="nord_maroc">Nord Maroc</option>
    <option value="sud_maroc">Sud Maroc</option>
    <option value="nord_sahara">Nord Sahara</option>
    <option value="sud_sahara">Sud Sahara</option>
  </select>
  <div id="coords"></div>
</div>

<div id="footer">@CartoMaroc</div>

<script>
var map = L.map('map').setView([30, -7], 5);

// الطبقة الأساسية (الأقمار الصناعية)
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19
}).addTo(map);

// طبقة الأسماء والحدود (شفافة)
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19,
    opacity: 1
}).addTo(map);

// حدود المناطق (خطوط أفقية متقطعة باللون الأصفر)
var boundaries = [
  { lat: 31.5 },
  { lat: 27.45 },
  { lat: 23.9667 }
];

// رسم الخطوط من الغرب (-13.5) إلى الشرق (-0.5) لتغطية كامل المغرب
boundaries.forEach(b => {
  L.polyline([[b.lat, -13.5], [b.lat, -0.5]], {
    color: 'red',
    weight: 2,
    opacity: 3,
    dashArray: '10, 10'
  }).addTo(map);
});

var marker;
  
  function toDMS(dec){
    const deg = Math.floor(dec);
    const minFloat = (Math.abs(dec - deg)) * 60;
    const min = Math.floor(minFloat);
    const sec = Math.round((minFloat - min) * 60);
    return `${deg}°${min}'${sec}"`;
}


map.on("click", function(e){
    var lat = e.latlng.lat;
    var lng = e.latlng.lng;

    if (marker) map.removeLayer(marker);

    marker = L.marker([lat, lng]).addTo(map)
              .bindPopup(`Lat: ${lat.toFixed(6)}<br>Lng: ${lng.toFixed(6)}`)
              .openPopup();

    var zone = document.getElementById("zone").value;
    var coordsText = `
<p><b>Lat:</b> ${lat.toFixed(6)} &nbsp; <b>Lng:</b> ${lng.toFixed(6)}</p>
<p><b>DMS:</b>  ${toDMS(lat)} , ${toDMS(lng)}</p>
`;

    coordsText += `<p><b>${zone}:</b> ${convertCoords(lat, lng, zone)}</p>`;
    coordsText += `<span class="copy-btn" onclick="copyCoords('${lat.toFixed(6)}, ${lng.toFixed(6)}')">نسخ الإحداثيات</span>`;
    document.getElementById("coords").innerHTML = coordsText;
});

function convertCoords(lat, lng, zone){
    // تحويل تقريبي إلى Merchich (تمثيلي لأغراض العرض فقط)
    let x, y;
    switch(zone){
        case "nord_maroc":
            x = 140000 + (lng + 5) * 4000;
            y = 400000 + (lat - 34) * 9000;
            break;
        case "sud_maroc":
            x = 140000 + (lng + 5) * 4000;
            y = 200000 + (lat - 30) * 9000;
            break;
        case "nord_sahara":
            x = 140000 + (lng + 5) * 4000;
            y = 100000 + (lat - 27) * 9000;
            break;
        case "sud_sahara":
            x = 140000 + (lng + 5) * 4000;
            y = 50000 + (lat - 25) * 9000;
            break;
    }
    return `${Math.round(x)} , ${Math.round(y)}`;
}

function copyCoords(text){
    navigator.clipboard.writeText(text);
    alert("تم نسخ الإحداثيات!");
}
</script>
</body>
</html>

